!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("preact")):"function"==typeof define&&define.amd?define(["preact"],n):t.animate=n(t.preact)}(this,function(t){"use strict";function n(t,n){function e(){this.constructor=t}for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}function e(t,n){var e=null;return t&&t.forEach(function(t){e||t&&t.key===n&&(e=t)}),e}function i(t,n,e){var i=null;return t&&t.forEach(function(t){if(t&&t.key===n&&t.attributes[e]){if(i)throw new Error("two child with same key for <Animate> children");i=t}}),i}function r(t,n,e){var i=t.length===n.length;return i&&t.forEach(function(t,r){var o=n[r];t&&o&&(t&&!o||!t&&o?i=!1:t.key!==o.key?i=!1:e&&t.attributes[e]!==o.attributes[e]&&(i=!1))}),i}function o(t,n){var i=[],r={},o=[];return t.forEach(function(t){t&&e(n,t.key)?o.length&&(r[t.key]=o,o=[]):o.push(t)}),n.forEach(function(t){t&&r.hasOwnProperty(t.key)&&(i=i.concat(r[t.key])),i.push(t)}),i=i.concat(o)}function a(t){return t&&t instanceof b}function s(t,n,e){t.addEventListener(n,e,!1)}function p(t,n,e){t.removeEventListener(n,e,!1)}function c(t,n){for(var e=window.getComputedStyle(t,null),i="",r=0,o=S;r<o.length;r++){var a=o[r];if(i=e.getPropertyValue(a+n))break}return i}function u(t){if(P){var n=parseFloat(c(t,"transition-delay"))||0,e=parseFloat(c(t,"transition-duration"))||0,i=parseFloat(c(t,"animation-delay"))||0,r=parseFloat(c(t,"animation-duration"))||0,o=Math.max(e+n,r+i);t.rcEndAnimTimeout=setTimeout(function(){t.rcEndAnimTimeout=null,t.rcEndListener&&t.rcEndListener()},1e3*o+200)}}function l(t){t.rcEndAnimTimeout&&(clearTimeout(t.rcEndAnimTimeout),t.rcEndAnimTimeout=null)}function f(t,n,e){var i=void 0===n?"undefined":"object"==typeof n,r=i?n.name:n,o=i?n.active:n+"-active",a=e,s=void 0,p=void 0,c=new L(t);return e&&"[object Object]"===Object.prototype.toString.call(e)&&(a=e.end,s=e.start,p=e.active),t.rcEndListener&&t.rcEndListener(),t.rcEndListener=function(n){n&&n.target!==t||(t.rcAnimTimeout&&(clearTimeout(t.rcAnimTimeout),t.rcAnimTimeout=null),l(t),c.remove(r),c.remove(o),O.removeEndEventListener(t,t.rcEndListener),t.rcEndListener=null,a&&a())},O.addEndEventListener(t,t.rcEndListener),s&&s(),c.add(r),t.rcAnimTimeout=setTimeout(function(){t.rcAnimTimeout=null,c.add(o),p&&setTimeout(p,0),u(t)},30),{stop:function(){t.rcEndListener&&t.rcEndListener()}}}function d(n){var e=[];return n.children.forEach(function(n){a(n)&&(n.key||(n=t.cloneElement(n,{key:C})),e.push(n))}),e}function h(){}function m(n,e){var i="display: none;";n.attributes.style&&("string"==typeof n.attributes.style?(i=n.attributes.style.replace(/display *: *\w+ *;?/i,""),i+="display: none;"):i=E({},n.attributes.style,{display:"none"}));var r=null;return r=e?E({},e,{style:i}):{style:i},t.cloneElement(n,r)}function y(n,e){if(n.attributes.style){var i=void 0;if("string"==typeof n.attributes.style)i=n.attributes.style.replace(/display *: *\w+ *;?/i,"");else{if(!n.attributes.style.display)return n;delete(i=E({},n.attributes.style)).display}var r=null;return r=e?E({},e,{style:i}):{style:i},t.cloneElement(n,r)}return n}var v="default"in t?t.default:t;const E=Object.assign||function(t){for(var n,e=1;e<arguments.length;e++){n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};var b=t.h("a",null).constructor,A=/\s+/,k=Object.prototype.toString,w=function(t,n){if(t.indexOf)return t.indexOf(n);for(var e=0;e<t.length;++e)if(t[e]===n)return e;return-1},L=function(){function t(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}return t.prototype.add=function(t){if(this.list)return this.list.add(t),this;var n=this.array();return-1===w(n,t)&&n.push(t),this.el.className=n.join(" "),this},t.prototype.remove=function(t){if("[object RegExp]"===k.call(t))return this.removeMatching(t);if(this.list)return this.list.remove(t),this;var n=this.array(),e=w(n,t);return-1!==e&&n.splice(e,1),this.el.className=n.join(" "),this},t.prototype.removeMatching=function(t){for(var n=0,e=this.array();n<e.length;n++){var i=e[n];t.test(i)&&this.remove(i)}return this},t.prototype.array=function(){var t=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(A);return""===t[0]&&t.shift(),t},t}(),g={transitionend:{transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"mozTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"},animationend:{animation:"animationend",WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd"}},T=[];"undefined"!=typeof window&&"undefined"!=typeof document&&function(){var t=document.createElement("div").style;"AnimationEvent"in window||delete g.animationend.animation,"TransitionEvent"in window||delete g.transitionend.transition;for(var n in g)if(g.hasOwnProperty(n)){var e=g[n];for(var i in e)if(i in t){T.push(e[i]);break}}}();var O={addEndEventListener:function(t,n){0!==T.length?T.forEach(function(e){s(t,e,n)}):window.setTimeout(n,0)},endEvents:T,removeEndEventListener:function(t,n){0!==T.length&&T.forEach(function(e){p(t,e,n)})}},P=0!==O.endEvents.length,S=["-webkit-","-moz-","-o-","ms-",""];f.isCssAnimationSupported=P;var j={isAppearSupported:function(t){return t.transitionName&&t.transitionAppear||t.animation.appear},isEnterSupported:function(t){return t.transitionName&&t.transitionEnter||t.animation.enter},isLeaveSupported:function(t){return t.transitionName&&t.transitionLeave||t.animation.leave},allowAppearCallback:function(t){return t.transitionAppear||t.animation.appear},allowEnterCallback:function(t){return t.transitionEnter||t.animation.enter},allowLeaveCallback:function(t){return t.transitionLeave||t.animation.leave},findDOMNode:function(t){return"function"==typeof v.findDOMNode?v.findDOMNode(t):t.base||t}},x={enter:"transitionEnter",appear:"transitionAppear",leave:"transitionLeave"},N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.componentWillUnmount=function(){this.stop()},e.prototype.componentWillEnter=function(t){j.isEnterSupported(this.props)?this.transition("enter",t):t()},e.prototype.componentWillAppear=function(t){j.isAppearSupported(this.props)?this.transition("appear",t):t()},e.prototype.componentWillLeave=function(t){j.isLeaveSupported(this.props)?this.transition("leave",t):t()},e.prototype.transition=function(t,n){var e=this,i=j.findDOMNode(this),r=this.props,o=r.transitionName,a="object"==typeof o;this.stop();var s=function(){e.stopper=null,n()};if((P||!r.animation[t])&&o&&r[x[t]]){var p=a?o[t]:o+"-"+t,c=p+"-active";a&&o[t+"Active"]&&(c=o[t+"Active"]),this.stopper=f(i,{name:p,active:c},s)}else this.stopper=r.animation[t](i,s)},e.prototype.stop=function(){var t=this.stopper;t&&(this.stopper=null,t.stop())},e.prototype.render=function(){return this.props.children&&this.props.children[0]},e}(t.Component),C="rc_animate_"+Date.now();return function(s){function p(n,e){var i=s.call(this,n,e)||this;i.performEnter=function(t){i.childrenRefs[t]&&(i.currentlyAnimatingKeys[t]=!0,i.childrenRefs[t].componentWillEnter(i.handleDoneAdding.bind(i,t,"enter")))},i.performAppear=function(t){i.childrenRefs[t]&&(i.currentlyAnimatingKeys[t]=!0,i.childrenRefs[t].componentWillAppear(i.handleDoneAdding.bind(i,t,"appear")))},i.handleDoneAdding=function(t,n){var e=i.props;if(delete i.currentlyAnimatingKeys[t],!e.exclusive||e===i.nextProps){var r=d(e);i.isValidChildByKey(r,t)?"appear"===n?j.allowAppearCallback(e)&&(e.onAppear(t),e.onEnd(t,!0)):j.allowEnterCallback(e)&&(e.onEnter(t),e.onEnd(t,!0)):i.performLeave(t)}},i.performLeave=function(t){i.childrenRefs[t]&&(i.currentlyAnimatingKeys[t]=!0,i.childrenRefs[t].componentWillLeave(i.handleDoneLeaving.bind(i,t)))},i.handleDoneLeaving=function(t){var n=i.props;if(delete i.currentlyAnimatingKeys[t],!n.exclusive||n===i.nextProps){var e=d(n);if(i.isValidChildByKey(e,t))i.performEnter(t);else{var o=function(){j.allowLeaveCallback(n)&&(n.onLeave(t),n.onEnd(t,!1))};if(r(i.state.children,e,n.showProp))o();else{var a=null;n.showProp&&(a=e.map(function(e){return e.key!==t||n.disableShow||e.attributes.disableShow?e:m(e)})),i.state.children=a||e,i.forceUpdate(o)}}}},i.currentlyAnimatingKeys={},i.keysToEnter=[],i.keysToLeave=[];var o=[];return i.props.children.forEach(function(n){a(n)&&(n.key||(n=t.cloneElement(n,{key:C})),!i.props.showProp||i.props.disableShow||n.attributes.disableShow||(n=n.attributes[i.props.showProp]?y(n):m(n)),o.push(n))}),i.state={children:o},i.childrenRefs={},i}return n(p,s),p.prototype.componentDidMount=function(){var t=this,n=this.props.showProp,e=this.state.children;n&&(e=e.filter(function(t){return!!t.attributes[n]})),e.forEach(function(n){n&&t.performAppear(n.key)})},p.prototype.componentWillReceiveProps=function(n,r){var a=this;this.nextProps=n;var s=d(n),p=this.props;p.exclusive&&Object.keys(this.currentlyAnimatingKeys).forEach(function(t){a.stop(t)});var c=p.showProp,u=this.currentlyAnimatingKeys,l=p.exclusive?d(p):this.state.children,f=[];c?(l.forEach(function(n){var i,r=n&&e(s,n.key);if(r&&r.attributes[c]||!n.attributes[c])i=m(r);else{var o=r||n;i=p.disableShow||o.attributes.disableShow?y(o,(u={},u[c]=!0,u)):t.cloneElement(o,(a={},a[c]=!0,a))}i&&f.push(i);var a,u}),s.forEach(function(t){t&&e(l,t.key)||f.push(t)})):f=o(l,s),this.setState({children:f}),s.forEach(function(t){var n=t&&t.key;if(!t||!u[n]){var r=t&&e(l,n);if(c){var o=t.attributes[c];r?!i(l,n,c)&&o&&a.keysToEnter.push(n):o&&a.keysToEnter.push(n)}else r||a.keysToEnter.push(n)}}),l.forEach(function(t){var n=t&&t.key;if(!t||!u[n]){var r=t&&e(s,n);if(c){var o=t.attributes[c];r?!i(s,n,c)&&o&&a.keysToLeave.push(n):o&&a.keysToLeave.push(n)}else r||a.keysToLeave.push(n)}})},p.prototype.componentDidUpdate=function(){var t=this.keysToEnter;this.keysToEnter=[],t.forEach(this.performEnter);var n=this.keysToLeave;this.keysToLeave=[],n.forEach(this.performLeave)},p.prototype.isValidChildByKey=function(t,n){var r=this.props.showProp;return r?i(t,n,r):e(t,n)},p.prototype.stop=function(t){delete this.currentlyAnimatingKeys[t];var n=this.childrenRefs[t];n&&n.stop()},p.prototype.render=function(){var n=this,e=this.props;this.nextProps=e;var i=this.state.children,r=null;i&&(r=i.map(function(i){if(null===i||void 0===i)return i;if(!i.key)throw new Error("must set key for <rc-animate> children");return t.h(N,{key:i.key,ref:function(t){n.childrenRefs[i.key]=t},animation:e.animation,transitionEnter:e.transitionEnter,transitionAppear:e.transitionAppear,transitionName:e.transitionName,transitionLeave:e.transitionLeave},i)}));var o=e.component;if(o){var a=e;return"string"==typeof o&&(a=E({className:e.className,style:e.style},e.componentProps)),t.h(o,E({},a),r)}return r[0]||null},p.defaultProps={animation:{},component:"span",componentProps:{},transitionEnter:!0,transitionLeave:!0,transitionAppear:!1,disableShow:!1,onEnd:h,onEnter:h,onLeave:h,onAppear:h},p}(t.Component)});
