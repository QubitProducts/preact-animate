!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("preact")):"function"==typeof define&&define.amd?define(["preact"],t):n.animate=t(n.preact)}(this,function(n){"use strict";function t(n,t){function e(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}function e(n,t,e){return null==n?null:(e&&e!==n&&(t=t.bind(e)),Array.prototype.map.call(n,t))}function i(n,t,e){return null==n?null:(e&&e!==n&&(t=t.bind(e)),Array.prototype.forEach.call(n,t))}function r(n,t){var e=null;return i(n,function(n){e||n&&n.key===t&&(e=n)}),e}function o(n,t,e){var r=null;return i(n,function(n){if(n&&n.key===t&&n.attributes[e]){if(r)throw new Error("two child with same key for <Animate> children");r=n}}),r}function a(n,t,e){var r=n.length===t.length;return r&&i(n,function(n,i){var o=t[i];n&&o&&(n&&!o||!n&&o?r=!1:n.key!==o.key?r=!1:e&&n.attributes[e]!==o.attributes[e]&&(r=!1))}),r}function s(n,t){var e=[],o={},a=[];return i(n,function(n){n&&r(t,n.key)?a.length&&(o[n.key]=a,a=[]):a.push(n)}),i(t,function(n){n&&o.hasOwnProperty(n.key)&&(e=e.concat(o[n.key])),e.push(n)}),e=e.concat(a)}function p(n){return n&&n instanceof g}function l(n,t,e){n.addEventListener(t,e,!1)}function u(n,t,e){n.removeEventListener(t,e,!1)}function c(n,t){for(var e=window.getComputedStyle(n,null),i="",r=0,o=O;r<o.length;r++){var a=o[r];if(i=e.getPropertyValue(a+t))break}return i}function f(n){if(C){var t=parseFloat(c(n,"transition-delay"))||0,e=parseFloat(c(n,"transition-duration"))||0,i=parseFloat(c(n,"animation-delay"))||0,r=parseFloat(c(n,"animation-duration"))||0,o=Math.max(e+t,r+i);n.rcEndAnimTimeout=setTimeout(function(){n.rcEndAnimTimeout=null,n.rcEndListener&&n.rcEndListener()},1e3*o+200)}}function d(n){n.rcEndAnimTimeout&&(clearTimeout(n.rcEndAnimTimeout),n.rcEndAnimTimeout=null)}function h(n,t,e,i){var r=void 0===t?"undefined":"object"==typeof t,o=r?t.name:t,a=r?t.active:t+"-active",s=e,p=void 0,l=void 0,u=new b(n);return e&&"[object Object]"===Object.prototype.toString.call(e)&&(s=e.end,p=e.start,l=e.active),n.rcEndListener&&n.rcEndListener(),n.rcEndListener=function(t){t&&t.target!==n||(n.rcAnimTimeout&&(clearTimeout(n.rcAnimTimeout),n.rcAnimTimeout=null),d(n),u.remove(o),u.remove(a),i&&S.removeEndEventListener(n,n.rcEndListener),n.rcEndListener=null,s&&s())},i&&S.addEndEventListener(n,n.rcEndListener),p&&p(),u.add(o),n.rcAnimTimeout=setTimeout(function(){n.rcAnimTimeout=null,u.add(a),l&&setTimeout(l,0),i&&f(n)},30),{stop:function(){n.rcEndListener&&n.rcEndListener()}}}function y(n){return"function"==typeof E.findDOMNode?E.findDOMNode(n):n.base||n}function m(t){var e=[];return i(t.children,function(t){p(t)&&(t.key||(t=n.cloneElement(t,{key:j})),e.push(t))}),e}function v(){}var E="default"in n?n.default:n;const A=Object.assign||function(n){for(var t,e=1;e<arguments.length;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n};var g=n.h("a",null).constructor,L=/\s+/,k=Object.prototype.toString,w=function(n,t){if(n.indexOf)return n.indexOf(t);for(var e=0;e<n.length;++e)if(n[e]===t)return e;return-1},b=function(){function n(n){if(!n||!n.nodeType)throw new Error("A DOM element reference is required");this.el=n,this.list=n.classList}return n.prototype.add=function(n){if(this.list)return this.list.add(n),this;var t=this.array();return-1===w(t,n)&&t.push(n),this.el.className=t.join(" "),this},n.prototype.remove=function(n){if("[object RegExp]"===k.call(n))return this.removeMatching(n);if(this.list)return this.list.remove(n),this;var t=this.array(),e=w(t,n);return-1!==e&&t.splice(e,1),this.el.className=t.join(" "),this},n.prototype.removeMatching=function(n){for(var t=0,e=this.array();t<e.length;t++){var i=e[t];n.test(i)&&this.remove(i)}return this},n.prototype.array=function(){var n=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(L);return""===n[0]&&n.shift(),n},n}(),D={transitionend:{transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"mozTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"},animationend:{animation:"animationend",WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd"}},T=[];"undefined"!=typeof window&&"undefined"!=typeof document&&function(){var n=document.createElement("div").style;"AnimationEvent"in window||delete D.animationend.animation,"TransitionEvent"in window||delete D.transitionend.transition;for(var t in D)if(D.hasOwnProperty(t)){var e=D[t];for(var i in e)if(i in n){T.push(e[i]);break}}}();var S={addEndEventListener:function(n,t){0!==T.length?T.forEach(function(e){l(n,e,t)}):window.setTimeout(t,0)},endEvents:T,removeEndEventListener:function(n,t){0!==T.length&&T.forEach(function(e){u(n,e,t)})}},C=0!==S.endEvents.length,O=["-webkit-","-moz-","-o-","ms-",""];h.isCssAnimationSupported=C;var N={isAppearSupported:function(n){return n.transitionName&&n.transitionAppear||n.animation.appear},isEnterSupported:function(n){return n.transitionName&&n.transitionEnter||n.animation.enter},isDisappearSupported:function(n){return n.transitionName&&n.transitionDisappear||n.animation.disappear},isLeaveSupported:function(n){return n.transitionName&&n.transitionLeave||n.animation.leave},allowAppearCallback:function(n){return n.transitionAppear||n.animation.appear},allowEnterCallback:function(n){return n.transitionEnter||n.animation.enter},allowLeaveCallback:function(n){return n.transitionLeave||n.animation.leave},findDOMNode:y,addDisplyNone:function(n){var t=y(n);t&&t.style&&(t.style.display&&""!==t.style.display&&(n.displayCss=t.style.display),t.style.display="none")},removeDisplyNone:function(n){var t=y(n);t&&t.style&&(n.displayCss&&""!==n.displayCss&&"none"!==n.displayCss?t.style.display=n.displayCss:t.style.display="")},isDisplyShow:function(n,t){return n.showProp&&!n.disableShow&&!t.disableShow}},P={enter:"transitionEnter",appear:"transitionAppear",leave:"transitionLeave",disappear:"transitionDisappear"},x=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return t(e,n),e.prototype.componentWillUnmount=function(){this.stop()},e.prototype.togglerDisply=function(n){this.props.displyShow&&(n?N.removeDisplyNone(this):N.addDisplyNone(this))},e.prototype.componentWillEnter=function(n){N.isEnterSupported(this.props)?(this.togglerDisply(!0),this.transition("enter",n)):(this.togglerDisply(!0),n())},e.prototype.componentWillAppear=function(n){N.isAppearSupported(this.props)?(this.togglerDisply(!0),this.transition("appear",n)):(this.togglerDisply(!0),n())},e.prototype.componentWillDisappear=function(n){var t=this;N.isDisappearSupported(this.props)?this.transition("disappear",function(){t.togglerDisply(!1),n()}):(this.togglerDisply(!1),n())},e.prototype.componentWillLeave=function(n){var t=this;N.isLeaveSupported(this.props)?this.transition("leave",function(){t.togglerDisply(!1),n()}):(this.togglerDisply(!1),n())},e.prototype.transition=function(n,t){var e=this,i=N.findDOMNode(this),r=this.props,o=r.transitionName,a="object"==typeof o;this.stop();var s=function(){e.stopper=null,t()};if((C||!r.animation[n])&&o&&r[P[n]]){var p=a?o[n]:o+"-"+n,l=p+"-active";a&&o[n+"Active"]&&(l=o[n+"Active"]);var u=!0,c=null;r.onEnter&&"enter"===n?(u=!1,c=r.onEnter):r.onLeave&&"leave"===n&&(u=!1,c=r.onLeave),this.stopper=h(i,{name:p,active:l},s,u),!u&&c&&c(this,this.stop.bind(this))}else this.stopper=r.animation[n](i,s)},e.prototype.stop=function(){var n=this.stopper;n&&(this.stopper=null,n.stop())},e.prototype.render=function(){return this.props.children&&this.props.children[0]},e}(n.Component),j="rc_animate_"+Date.now();return function(l){function u(t,e){var r=l.call(this,t,e)||this;r.performEnter=function(n){var t=r.childrenRefs[n];t&&(r.currentlyAnimatingKeys[n]=1,r.props.onBeforeEnter&&r.props.onBeforeEnter(t),t.componentWillEnter(function(){r.handleDoneAdding(n,"enter")}))},r.performLeave=function(n){var t=r.childrenRefs[n];t&&(r.currentlyAnimatingKeys[n]=2,r.props.onBeforeLeave&&r.props.onBeforeLeave(t),t.componentWillLeave(function(){r.handleDoneLeaving(n)}))},r.performAppear=function(n){r.childrenRefs[n]&&(r.currentlyAnimatingKeys[n]=3,r.childrenRefs[n].componentWillAppear(r.handleDoneAdding.bind(r,n,"appear")))},r.performDisappear=function(n){r.childrenRefs[n]&&(r.currentlyAnimatingKeys[n]=4,r.childrenRefs[n].componentWillDisappear(r.handleDoneLeaving.bind(r,n)))},r.handleDoneAdding=function(n,t){var e=r.props;if(delete r.currentlyAnimatingKeys[n],!e.exclusive||e===r.nextProps){var i=m(e);r.isValidChildByKey(i,n)?"appear"===t?N.allowAppearCallback(e)&&e.onEnd(n,!0):N.allowEnterCallback(e)&&(r.callLife(n,e.onAfterEnter),e.onEnd(n,!0)):r.performLeave(n)}},r.handleDoneLeaving=function(n){var t=r.props;if(delete r.currentlyAnimatingKeys[n],!t.exclusive||t===r.nextProps){var e=m(t);if(r.isValidChildByKey(e,n))r.performEnter(n);else{var i=function(){N.allowLeaveCallback(t)&&(r.callLife(n,t.onAfterLeave),t.onEnd(n,!1))};a(r.state.children,e,t.showProp)?i():(r.state.children=e,r.forceUpdate(i))}}},r.currentlyAnimatingKeys={},r.keysToEnter=[],r.keysToLeave=[];var o=[];return i(r.props.children,function(t){p(t)&&(t.key||(t=n.cloneElement(t,{key:j})),o.push(t))}),r.state={children:o},r.childrenRefs={},r}return t(u,l),u.prototype.componentDidMount=function(){var n=this,t=this.props.showProp,e=this.state.children,r=[],o=[];t?i(e,function(n){n.attributes[t]?r.push(n):o.push(n)}):r=e,i(r,function(t){t&&n.performAppear(t.key)}),i(o,function(t){t&&n.performDisappear(t.key)})},u.prototype.componentWillReceiveProps=function(t,e){var a=this;this.nextProps=t;var p=m(t),l=this.props;l.exclusive&&i(Object.keys(this.currentlyAnimatingKeys),function(n){a.stop(n)});var u=l.showProp,c=this.currentlyAnimatingKeys,f=l.exclusive?m(l):this.state.children,d=[];u?(i(f,function(t){var e,i=t&&r(p,t.key),o=i||t;(e=i&&i.attributes[u]||!t.attributes[u]?i:n.cloneElement(o,(a={},a[u]=!0,a)))&&d.push(e);var a}),i(p,function(n){n&&r(f,n.key)||d.push(n)})):d=s(f,p),this.setState({children:d}),i(p,function(n){var t=n&&n.key;if(!n||!c[t]){var e=n&&r(f,t);if(u){var i=n.attributes[u];e?!o(f,t,u)&&i&&a.keysToEnter.push(t):i&&a.keysToEnter.push(t)}else e||a.keysToEnter.push(t)}}),i(f,function(n){var t=n&&n.key;if(!n||!c[t]){var e=n&&r(p,t);if(u){var i=n.attributes[u];e?!o(p,t,u)&&i&&a.keysToLeave.push(t):i&&a.keysToLeave.push(t)}else e||a.keysToLeave.push(t)}})},u.prototype.componentDidUpdate=function(){var n=this.keysToEnter;this.keysToEnter=[],i(n,this.performEnter);var t=this.keysToLeave;this.keysToLeave=[],i(t,this.performLeave)},u.prototype.callLife=function(n,t){t&&t(this.childrenRefs[n])},u.prototype.isValidChildByKey=function(n,t){var e=this.props.showProp;return e?o(n,t,e):r(n,t)},u.prototype.stop=function(n){var t=this.currentlyAnimatingKeys[n];delete this.currentlyAnimatingKeys[n];var e=this.childrenRefs[n];e&&(e.stop(),this.props.onAfterCancelled&&this.props.onAfterCancelled(e,t))},u.prototype.render=function(){var t=this,i=this.props;this.nextProps=i;var r=null;r=e(this.state.children,function(e){if(null===e||void 0===e)return e;if(!e.key)throw new Error("must set key for <rc-animate> children");var r={key:e.key,ref:function(n){t.childrenRefs[e.key]=n},animation:i.animation,transitionDisappear:i.transitionDisappear,transitionEnter:i.transitionEnter,transitionAppear:i.transitionAppear,transitionName:i.transitionName,transitionLeave:i.transitionLeave,onEnter:i.onEnter,onLeave:i.onLeave,displyShow:!1};return N.isDisplyShow(i,e.attributes)&&(r.displyShow=!0),n.h(x,r,e)});var o=i.component;if(o){var a=i;return"string"==typeof o&&(a=A({className:i.className,style:i.style},i.componentProps)),n.h(o,A({},a),r)}return r&&r[0]},u.defaultProps={exclusive:!0,animation:{},component:"span",componentProps:{},transitionEnter:!0,transitionLeave:!0,transitionAppear:!1,disableShow:!1,onEnd:v,onEnter:null,onLeave:null,onAppear:v},u}(n.Component)});
